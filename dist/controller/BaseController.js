sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/UIComponent","../model/formatter","sap/ui/core/Fragment","sap/ui/core/IconPool","sap/ui/model/Sorter","sap/m/MessageBox"],function(e,t,o,n,i,s,r){function a(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const l=a(o);const c=e.extend("icl.delivery.controller.BaseController",{constructor:function t(){e.prototype.constructor.apply(this,arguments);this.firstRun=true;this.formatter=l;this.fragments={}},onInit:function e(){const t=this.getDelivModel();if(this.firstRun){this.firstRun=false;this.loadIcons();this.loadUser(t);this.loadSections(t);this.loadSites(t);this.loadTypes(t);this.loadPersonalNumbers(t);this.loadPrinters(t)}},loadTypes:function e(t){void fetch("/mockData/types.JSON").then(e=>e.json()).then(e=>t.setProperty("/oData/types",e))},loadUser:function e(t){t.setProperty("/user",{name:"יורם אלקובי",contactName:"יוסי אבוקסיס",tel:"0549080187",site:"12",sections:["3","10"],sectionsNames:["חשמל 3","אינוונטר 17"]})},loadSections:function e(t){void fetch("/mockData/sections.JSON").then(e=>e.json()).then(e=>t.setProperty("/oData/sections",e))},loadSites:function e(t){void fetch("/mockData/sites.JSON").then(e=>e.json()).then(e=>t.setProperty("/oData/sites",e))},loadPrinters:function e(t){void fetch("/mockData/printers.JSON").then(e=>e.json()).then(e=>{t.setProperty("/oData/printers",e)})},getOwnerComponent:function t(){return e.prototype.getOwnerComponent.call(this)},getRouter:function e(){return t.getRouterFor(this)},navTo:function e(t,o,n){this.getRouter().navTo(t,o,undefined,n)},onNavBack:function e(){window.history.go(-1)},getMainView:function e(){return this.getView()||this.viewController.getView()},cancelFragment:function e(t,o){const n=this.getMainView().getId()+"--"+o;this.fragments[n].close()},onFragmentHandler:async function e(t,o,i){const s=this.getMainView().getId()+"--"+o;if(!!this.fragments[s]&&!i&&this.fragments[s].isOpen()){this.cancelFragment(t,o)}else{const e=t?.getSource();if(!this.fragments[s]){const e=await n.load({name:"icl.delivery.view.fragments."+o,controller:this});this.fragments[s]=e;this.getView().addDependent(this.fragments[s])}i?this.fragments[s].open():this.fragments[s].openBy(e,true)}},deleteRowFromList:function e(t,o){for(let e=0;e<t.length;e++){if(t[e]==o){t.splice(e,1);break}}delComponent.getModel("LocalModel").refresh()},loadIcons:function e(){const t=[{fontFamily:"SAP-icons-TNT",fontURI:sap.ui.require.toUrl("sap/tnt/themes/base/fonts/")},{fontFamily:"BusinessSuiteInAppSymbols",fontURI:sap.ui.require.toUrl("sap/ushell/themes/base/fonts/")}];t.forEach(e=>{i.registerFont(e)})},loadPersonalNumbers:function e(t){void fetch("/mockData/personalNumbers.JSON").then(e=>e.json()).then(e=>{t.setProperty("/oData/personalNumbers",e)})},getDelivModel:function e(){const t=delComponent.getModel("DelModel");return t},toggleFlag:function e(t,o){const n=this.getDelivModel();n.setProperty(o,!n.getProperty(o))},goBackHome:function e(){this.navTo("main")},initTableSelections:function e(t){const o=this.getDelivModel();o.setProperty("/oMaintain/share",{});const n=this.getView().byId(t);n.removeSelections(true);n.getBinding("items").filter(null);n.getBinding("items").sort(null)},sortTable:function e(t,o){const n=this.getView().byId(o),i=n.getBinding("items"),r=t.getParameter("item").getKey(),a=[new s(r,false,false)];i.sort(a)},reviewItem:function e(t,o){const n=this.getDelivModel();void fetch("/mockData/reviewItem.JSON").then(e=>e.json()).then(e=>{const t=e.find(e=>e.catNum===o);n.setProperty("/oData/itemReview",t)});void this.onFragmentHandler(t,"Dialog_ItemReview",true)},openNumsDialog:function e(t){const o=this.getDelivModel();const n=t.getSource().getBindingContext("DelModel").getPath();o.setProperty("/oMaintain/share/selNumber",null);o.setProperty("/oMaintain/share/itemPathForPesonalNum",n);void this.onFragmentHandler(t,"Dialog_SelectNum",true)},onSelectNum:function e(t){const o=this.getDelivModel();const n=t.getParameter("listItem").getBindingContext("DelModel").getObject();o.setProperty("/oMaintain/share/selNumber",n)},onSaveNum:function e(t){const o=this.getDelivModel();const n=o.getProperty("/oMaintain/share/itemPathForPesonalNum");const i=o.getProperty("/oMaintain/share/selNumber");if(!i){r.error("לא בחרת שום מספר")}else{o.setProperty(`${n}/personalNum`,i.presonalNum);void this.cancelFragment(t,"Dialog_SelectNum")}},onPrintDialog:function e(t){void this.onFragmentHandler(t,"Dialog_Print",true)},disableComboBox:function e(t){const o=this.getView().byId(t);if(o)o.addEventDelegate({onclick:()=>{o.open()},onkeydown:e=>{e.preventDefault()}})},requestReview:function e(t,o){const n=this.getDelivModel();void fetch("/mockData/collectReview.JSON").then(e=>e.json()).then(e=>{const t=e.find(e=>e.requestId===o);n.setProperty("/oData/collectReview",t)});void this.onFragmentHandler(t,"PopOver_ReqReview")}});return c});