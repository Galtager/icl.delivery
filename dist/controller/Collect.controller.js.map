{"version":3,"file":"Collect.controller.js","names":["BaseController","_interopRequireDefault","__BaseController","Collect","extend","onAfterRendering","_onAfterRendering","disableComboBox","onInit","_onInit","BaseController.prototype.onInit.call","oRouter","UIComponent","getRouterFor","getRoute","attachMatched","_initialFunc","initTableSelections","deliveryModel","getDelivModel","setProperty","delComponent","i18n","currCollect","getProperty","loadItems","onNavBack","_loadItems","fetch","then","res","json","data","filterItems","_filterItems","oEvent","searchValue","getParameter","table","getView","byId","oBinding","getBinding","filters","Filter","FilterOperator","Contains","filter","onStartCollectDialog","_onStartCollectDialog","onFragmentHandler","startCollect","_startCollect","setTimeout","cancelFragment","showBlob","_showBlob","alert","onFinishCollect","_onFinishCollect","getItems","length","getSelectedItems","materialNum","MessageBox","show","onPrintFinish","_onPrintFinish","onDigitalSignDialog","_onDigitalSignDialog","cleanSign","attachSignEvent","_attachSignEvent","vbox","sap","ui","getCore","signaturePad","attachBrowserEvent","_cleanSign","VBox","clear","deleteReq","_deleteReq","navTo"],"sources":["../../src/controller/Collect.controller.ts"],"sourcesContent":["\r\n/* eslint-disable @typescript-eslint/no-explicit-any */\r\n/* eslint-disable @typescript-eslint/no-unsafe-call */\r\n/* eslint-disable @typescript-eslint/no-unsafe-member-access */\r\n\r\nimport UIComponent from \"sap/ui/core/UIComponent\";\r\nimport BaseController from \"./BaseController\";\r\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\r\nimport Event from \"sap/ui/base/Event\";\r\nimport Table from \"sap/m/Table\";\r\nimport ListBinding from \"sap/ui/model/ListBinding\";\r\nimport Filter from \"sap/ui/model/Filter\";\r\nimport FilterOperator from \"sap/ui/model/FilterOperator\";\r\nimport MessageBox from \"sap/m/MessageBox\";\r\nimport VBox from \"sap/m/VBox\";\r\nimport { ICollectRequest } from \"./Main.controller\";\r\n\r\n\r\n/**\r\n * @namespace icl.delivery.controller\r\n */\r\nexport default class Collect extends BaseController {\r\n    onAfterRendering() {\r\n        this.disableComboBox('noWriteCombo2')\r\n    }\r\n    onInit() {\r\n        super.onInit();\r\n        const oRouter = UIComponent.getRouterFor(this);\r\n        // eslint-disable-next-line @typescript-eslint/unbound-method\r\n        oRouter.getRoute(\"collect\").attachMatched(this._initialFunc, this);\r\n    }\r\n    public _initialFunc() {\r\n        this.initTableSelections('itemsTable')\r\n        const deliveryModel = this.getDelivModel();\r\n        deliveryModel.setProperty('/oMaintain/title', delComponent.i18n('collectFrom'));\r\n        deliveryModel.setProperty('/oFlags/headerNavBack', true);\r\n        deliveryModel.setProperty('/currView', 'collect');\r\n\r\n        const currCollect = deliveryModel.getProperty('/oMaintain/collect/currCollect') as ICollectRequest\r\n        if (currCollect) {\r\n            this.loadItems(deliveryModel);\r\n        } else this.onNavBack()\r\n    }\r\n    public loadItems(deliveryModel: JSONModel) {\r\n        void fetch(\"/mockData/collectItems.JSON\")\r\n            .then(res => res.json())\r\n            .then((data) => {\r\n                deliveryModel.setProperty('/oData/collectItems', data);\r\n            });\r\n    }\r\n    public filterItems(oEvent: Event) {\r\n        const searchValue = oEvent.getParameter('newValue') as string,\r\n            table = this.getView().byId('itemsTable') as Table,\r\n            oBinding = table.getBinding(\"items\") as ListBinding,\r\n            filters: Filter[] = [new Filter('catNum', FilterOperator.Contains, searchValue)];\r\n        oBinding.filter(searchValue ? filters : null);\r\n    }\r\n    public onStartCollectDialog(oEvent: Event) {\r\n        const deliveryModel = this.getDelivModel();\r\n\r\n        // check if have error before start -- need to fetch server\r\n        deliveryModel.setProperty('/oMaintain/collect/startError', 'הפק\"ע סגורה');\r\n\r\n        void this.onFragmentHandler(oEvent, 'Dialog_StartCollect', true)\r\n\r\n    }\r\n    public startCollect(oEvent: Event) {\r\n        const deliveryModel = this.getDelivModel();\r\n        deliveryModel.setProperty('/oMaintain/share/showStartDialog', true);\r\n        deliveryModel.setProperty('/oMaintain/collect/start', true);\r\n        setTimeout(() => {\r\n            void this.cancelFragment(oEvent, 'Dialog_StartCollect')\r\n\r\n        }, 1500)\r\n\r\n    }\r\n    public showBlob() {\r\n        alert('show blob as url')\r\n    }\r\n    public onFinishCollect(oEvent: Event) {\r\n        const deliveryModel = this.getDelivModel();\r\n        const table = this.getView().byId('itemsTable') as Table;\r\n        if (table.getItems().length === table.getSelectedItems().length) {\r\n            deliveryModel.setProperty('/oMaintain/collect/endCollect', { materialNum: '123456777' });\r\n            // send post request to sap then get response for material number\r\n            void this.onFragmentHandler(oEvent, 'Dialog_FinishCollect', true)\r\n        }\r\n        else\r\n            MessageBox.show('לא סימנת את כל הפריטים')\r\n    }\r\n    public onPrintFinish(oEvent: Event) {\r\n        const deliveryModel = this.getDelivModel();\r\n        // lock the screen and show after collect state\r\n        deliveryModel.setProperty('/oMaintain/collect/endCollect/finish', true);\r\n        deliveryModel.setProperty('/oMaintain/collect/start', false);\r\n        void this.cancelFragment(oEvent, 'Dialog_FinishCollect')\r\n    }\r\n    public async onDigitalSignDialog(oEvent: Event) {\r\n        await this.onFragmentHandler(oEvent, 'Dialog_DigitSign', true)\r\n        this.cleanSign();\r\n        this.attachSignEvent()\r\n\r\n    }\r\n    private attachSignEvent() {\r\n        const vbox = sap.ui.getCore().byId('signaturePad') as VBox;\r\n        const signaturePad = vbox.getItems()[0];\r\n        signaturePad.attachBrowserEvent('click', () => {\r\n            const deliveryModel = this.getDelivModel();\r\n            deliveryModel.setProperty('/oMaintain/collect/sign', true)\r\n        })\r\n    }\r\n    private cleanSign() {\r\n        const deliveryModel = this.getDelivModel();\r\n        deliveryModel.setProperty('/oMaintain/countedForm/signature', true)\r\n        const VBox = sap.ui.getCore().byId('signaturePad') as VBox;\r\n        const signaturePad: any = VBox.getItems()[0];\r\n        signaturePad.clear();\r\n        deliveryModel.setProperty('/oMaintain/collect/sign', false)\r\n\r\n    }\r\n    public deleteReq(oEvent: Event) {\r\n        this.cancelFragment(oEvent, 'Dialog_DeleteReq');\r\n        this.navTo('main')\r\n    }\r\n\r\n}"],"mappings":"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"}