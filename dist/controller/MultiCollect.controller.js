sap.ui.define(["sap/ui/core/UIComponent","./BaseController","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageBox"],function(t,e,o,l,i){function n(t){return t&&t.__esModule&&typeof t.default!=="undefined"?t.default:t}const r=n(e);const s=r.extend("icl.delivery.controller.MultiCollect",{onAfterRendering:function t(){this.disableComboBox("noWriteCombo3")},onInit:function e(){r.prototype.onInit.call(this);const o=t.getRouterFor(this);o.getRoute("multiCollect").attachMatched(this._initialFunc,this)},_initialFunc:function t(){this.initTableSelections("multiItemsTable");const e=this.getDelivModel();e.setProperty("/oFlags/headerNavBack",true);e.setProperty("/currView","multiCollect");const o=this.loadCollects(e);if(!o.length){this.onNavBack()}e.setProperty("/oMaintain/multiCollect/collectFilter",o.map(t=>t.reqNumber));void this.loadItems(e,o)},loadItems:async function t(e,o){const l=[];for(let t=0;t<o.length;t++){await fetch("/mockData/collectItems.JSON").then(t=>t.json()).then(e=>{const i=e.filter(e=>{if(e.requestId===o[t].requestId){e.reqNumber=o[t].reqNumber;return true}return false});l.push(...i)})}e.setProperty("/oData/multiCollectItems",l)},loadCollects:function t(e){const o=e.getProperty("/oData/collectList");if(o){const t=o.filter(t=>t.selected);t.map((t,e)=>t.reqNumber=e+1);e.setProperty("/oMaintain/multiCollect/currCollects",t);return t}return[]},onStartCollectDialog:function t(e){const o=this.getDelivModel();o.setProperty("/oMaintain/share/showStartDialog",true);void this.onFragmentHandler(e,"Dialog_StartCollect",true);o.setProperty("/oMaintain/multiCollect/start",true);setTimeout(()=>{void this.cancelFragment(e,"Dialog_StartCollect")},1500)},filter:function t(){const e=this.getDelivModel(),i=this.getView().byId("multiItemsTable"),n=i.getBinding("items"),r=[];const s=e.getProperty("/oMaintain/multiCollect/collectFilter");const c=e.getProperty("/oMaintain/multiCollect/searchFilter");c&&r.push(new o("catNum",l.Contains,c));const a=s.map(t=>new o("reqNumber",l.EQ,t));a.length&&r.push(new o({filters:a,and:false}));n.filter(r)},onFinishCollects:function t(e){const o=this.getView().byId("multiItemsTable");if(o.getItems().length===o.getSelectedItems().length){this.navTo("preview");this.groupByCollectReq()}else i.show("לא סימנת את כל הפריטים")},groupByCollectReq:function t(){const e=this.getDelivModel();const o=e.getProperty("/oMaintain/multiCollect/currCollects");const l=e.getProperty("/oData/multiCollectItems");const i=o.map(t=>{const e=l.filter(e=>e.reqNumber===t.reqNumber);t.items=e;return t});e.setProperty("/oMaintain/multiCollect/previewItems",i);console.log(i)}});return s});