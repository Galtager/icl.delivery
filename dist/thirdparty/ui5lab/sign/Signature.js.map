{"version":3,"file":"Signature.js","names":["sap","ui","define","Control","library","oSignature","extend","metadata","properties","height","type","defaultValue","width","backgroundColor","penColor","penSize","editable","aggregations","associations","events","init","onBeforeRendering","onAfterRendering","getEditable","_attachEvents","exit","_cleanUp","oSVG","_getD3SVG","on","_onStartDrawing","bind","_onStopDrawing","_onMove","setPenColor","sColor","setProperty","setPenSize","nValue","jQuery","log","error","d3","select","getId","getSVGString","html","setSVGString","sSvg","node","innerHTML","setEditable","bFlag","clear","rerender","_aPointData","_sPath","_bStartDrawing","_createLine","svg","line","interpolate","tension","x","d","y","oSvg","event","target","append","data","attr","getPenColor","getPenSize","oMousePointer","mouse","push"],"sources":["../../../../src/thirdparty/ui5lab/sign/Signature.js"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-empty-function */\r\n/* eslint-disable @typescript-eslint/no-unsafe-member-access */\r\n/* eslint-disable @typescript-eslint/no-unsafe-assignment */\r\n/* eslint-disable @typescript-eslint/no-unsafe-return */\r\n/* eslint-disable @typescript-eslint/no-unsafe-call */\r\n/* eslint-disable @typescript-eslint/restrict-plus-operands */\r\n/* eslint-disable no-undef */\r\nsap.ui.define([\"sap/ui/core/Control\", \"./library\"], function (Control, library) {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * Constructor for Signature control (based on http://bl.ocks.org/elidupuis/11325438)\r\n   * @param {string} [sId] ID for the new control, generated automatically if no ID is given\r\n   * @param {object} [mSettings] Initial settings for the new control\r\n   * @extends sap.ui.core.Control\r\n   * @author Srikanth KV\r\n   * @version 1.0.0\r\n   * @constructor\r\n   * @public\r\n   */\r\n  var oSignature = Control.extend(\"icl.delivery.thirdparty.ui5lab.sign.Signature\", {\r\n    metadata: {\r\n      library: \"ui5.sign\",\r\n      properties: {\r\n        /**\r\n         * Defines height of the control\r\n         */\r\n        height: { type: \"sap.ui.core.CSSSize\", defaultValue: \"100%\" },\r\n        /**\r\n         * Defines width of the control\r\n         */\r\n        width: { type: \"sap.ui.core.CSSSize\", defaultValue: \"100%\" },\r\n        /**\r\n         * Defines background color of the control\r\n         */\r\n        backgroundColor: {\r\n          type: \"sap.ui.core.CSSColor\",\r\n          defaultValue: \"rgb(221, 221, 221)\"\r\n        },\r\n        /**\r\n         * Defines color of pen/mouse/pointer for the control\r\n         */\r\n        penColor: { type: \"sap.ui.core.CSSColor\", defaultValue: \"black\" },\r\n        /**\r\n         * Defines size/width of pen\r\n         */\r\n        penSize: { type: \"int\", defaultValue: 2 },\r\n\r\n        /**\r\n         * Defines if the control is editable or not\r\n         */\r\n        editable: { type: \"boolean\", defaultValue: true }\r\n      },\r\n      aggregations: {},\r\n      associations: {},\r\n      events: {}\r\n    },\r\n\r\n    init: function () { },\r\n\r\n    onBeforeRendering: function () { },\r\n\r\n    onAfterRendering: function () {\r\n      if (this.getEditable()) {\r\n        this._attachEvents();\r\n      }\r\n    },\r\n\r\n    exit: function () {\r\n      this._cleanUp();\r\n    },\r\n\r\n    /**\r\n     * Attach mouse and touch events for the control\r\n     * @private\r\n     */\r\n    _attachEvents: function () {\r\n      // bind mousemove event\r\n      var oSVG = this._getD3SVG();\r\n\r\n      // mouse events\r\n      oSVG.on(\"mousedown\", _onStartDrawing.bind(this)); // bind control to event handler this\r\n      oSVG.on(\"mouseup\", _onStopDrawing);\r\n      oSVG.on(\"mouseleave\", _onStopDrawing);\r\n      oSVG.on(\"mousemove\", _onMove);\r\n\r\n      // touch events\r\n      oSVG.on(\"touchstart\", _onStartDrawing.bind(this)); // bind control to event handler this\r\n      oSVG.on(\"touchcancel\", _onStopDrawing);\r\n      oSVG.on(\"touchend\", _onStopDrawing);\r\n      oSVG.on(\"touchmove\", _onMove);\r\n    },\r\n\r\n    setPenColor: function (sColor) {\r\n      this.setProperty(\"penColor\", sColor, true); // true - avoid rerender\r\n      return this;\r\n    },\r\n\r\n    setPenSize: function (nValue) {\r\n      if (nValue < 1) {\r\n        jQuery.sap.log.error(\"Property 'penSize' cannot be less than 1\");\r\n      }\r\n      this.setProperty(\"penSize\", nValue, true); // true - avoid rerender\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Helper method to access SVG element via d3 (internal)\r\n     *\r\n     * @returns {object} Returns d3 selector for svg\r\n     */\r\n    _getD3SVG: function () {\r\n      return d3.select(\"#\" + this.getId()).select(\"svg\");\r\n    },\r\n\r\n    /**\r\n     * Unbind browser events and variables to avoid memory leaks (internal)\r\n     */\r\n    _cleanUp: function () {\r\n      // unbind browser events\r\n      this._getD3SVG().on(\"mousedown\", null);\r\n      this._getD3SVG().on(\"mousemove\", null);\r\n      this._getD3SVG().on(\"mouseup\", null);\r\n      this._getD3SVG().on(\"mouseleave\", null);\r\n\r\n      this._getD3SVG().on(\"touchstart\", null);\r\n      this._getD3SVG().on(\"touchcancel\", null);\r\n      this._getD3SVG().on(\"touchend\", null);\r\n      this._getD3SVG().on(\"touchmove\", null);\r\n    },\r\n\r\n    /**\r\n     * @returns {string} returns svg as string\r\n     */\r\n    getSVGString: function () {\r\n      return d3.select(\"#\" + this.getId()).html();\r\n    },\r\n\r\n    /**\r\n     * Provided SVG string input is rendered onto the screen.\r\n     * Also set's property 'editable' to false which makes the control\r\n     *    not editable for input\r\n     * @param {string} sSvg - SVG as string\r\n     * @returns {this} Current control reference\r\n     */\r\n    setSVGString: function (sSvg) {\r\n      d3.select(\"#\" + this.getId()).node().innerHTML = sSvg;\r\n      this.setEditable(false);\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * Enables or disables control for input based on input parameter\r\n     * @param {boolean} bFlag boolean falg to enable/disable\r\n     * @returns {this} Current control reference\r\n     */\r\n    setEditable: function (bFlag) {\r\n      // remove event handlers...so that control becomes non-editable\r\n      this.setProperty(\"editable\", bFlag, true); // true - avoid rerender\r\n      if (bFlag) {\r\n        this._attachEvents();\r\n      } else {\r\n        this._cleanUp();\r\n      }\r\n      return this;\r\n    },\r\n\r\n    /**\r\n     * clears svg content\r\n     * @returns {this} Current control reference\r\n     */\r\n    clear: function () {\r\n      this.rerender();\r\n      return this;\r\n    }\r\n  });\r\n\r\n  /********************************************************\r\n   * PRIVATE METHODS\r\n   *******************************************************/\r\n\r\n  // store x,y co-ordinates of path\r\n  var _aPointData = [];\r\n\r\n  // svg path\r\n  var _sPath;\r\n\r\n  // flag to indicate when to start and stop drawing\r\n  var _bStartDrawing = false;\r\n\r\n  // d3's line generator\r\n  var _createLine = d3.svg\r\n    .line()\r\n    .interpolate(\"bundle\")\r\n    .tension(1)\r\n    .x(function (d) {\r\n      return d.x;\r\n    })\r\n    .y(function (d) {\r\n      return d.y;\r\n    });\r\n\r\n  /**\r\n   * @private\r\n   * Event handler method to start drawing\r\n   * Note: 'this' is bound to UI control\r\n   */\r\n  function _onStartDrawing() {\r\n    _bStartDrawing = true;\r\n\r\n    // create new path for every mouse down\r\n    _aPointData = []; // clear point data before starting new path\r\n    var oSvg = d3.select(d3.event.target);\r\n    _sPath = oSvg\r\n      .append(\"path\")\r\n      .data([_aPointData])\r\n      .attr(\"fill\", \"none\")\r\n      .attr(\"stroke-linejoin\", \"round\")\r\n      .attr(\"stroke\", this.getPenColor())\r\n      .attr(\"stroke-width\", this.getPenSize())\r\n      .attr(\"d\", _createLine);\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * Event handler to stop drawing\r\n   */\r\n  function _onStopDrawing() {\r\n    // stop drawing\r\n    _bStartDrawing = false;\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * Event handler that creates line data when mouse/pointer is moved\r\n   */\r\n  function _onMove() {\r\n    if (_bStartDrawing) {\r\n      var oMousePointer = d3.mouse(this);\r\n      _aPointData.push({ x: oMousePointer[0], y: oMousePointer[1] });\r\n\r\n      _sPath.attr(\"d\", function (d) {\r\n        return _createLine(d);\r\n      });\r\n    }\r\n  }\r\n\r\n  return oSignature;\r\n});\r\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACAA,GAAG,CAACC,EAAE,CAACC,MAAM,CAAC,CAAC,qBAAqB,EAAE,WAAW,CAAC,EAAE,UAAUC,OAAO,EAAEC,OAAO,EAAE;EAC9E,YAAY;;EAEZ;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACE,IAAIC,UAAU,GAAGF,OAAO,CAACG,MAAM,CAAC,+CAA+C,EAAE;IAC/EC,QAAQ,EAAE;MACRH,OAAO,EAAE,UAAU;MACnBI,UAAU,EAAE;QACV;AACR;AACA;QACQC,MAAM,EAAE;UAAEC,IAAI,EAAE,qBAAqB;UAAEC,YAAY,EAAE;QAAO,CAAC;QAC7D;AACR;AACA;QACQC,KAAK,EAAE;UAAEF,IAAI,EAAE,qBAAqB;UAAEC,YAAY,EAAE;QAAO,CAAC;QAC5D;AACR;AACA;QACQE,eAAe,EAAE;UACfH,IAAI,EAAE,sBAAsB;UAC5BC,YAAY,EAAE;QAChB,CAAC;QACD;AACR;AACA;QACQG,QAAQ,EAAE;UAAEJ,IAAI,EAAE,sBAAsB;UAAEC,YAAY,EAAE;QAAQ,CAAC;QACjE;AACR;AACA;QACQI,OAAO,EAAE;UAAEL,IAAI,EAAE,KAAK;UAAEC,YAAY,EAAE;QAAE,CAAC;QAEzC;AACR;AACA;QACQK,QAAQ,EAAE;UAAEN,IAAI,EAAE,SAAS;UAAEC,YAAY,EAAE;QAAK;MAClD,CAAC;MACDM,YAAY,EAAE,CAAC,CAAC;MAChBC,YAAY,EAAE,CAAC,CAAC;MAChBC,MAAM,EAAE,CAAC;IACX,CAAC;IAEDC,IAAI,EAAE,SAAAA,CAAA,EAAY,CAAE,CAAC;IAErBC,iBAAiB,EAAE,SAAAA,CAAA,EAAY,CAAE,CAAC;IAElCC,gBAAgB,EAAE,SAAAA,CAAA,EAAY;MAC5B,IAAI,IAAI,CAACC,WAAW,EAAE,EAAE;QACtB,IAAI,CAACC,aAAa,EAAE;MACtB;IACF,CAAC;IAEDC,IAAI,EAAE,SAAAA,CAAA,EAAY;MAChB,IAAI,CAACC,QAAQ,EAAE;IACjB,CAAC;IAED;AACJ;AACA;AACA;IACIF,aAAa,EAAE,SAAAA,CAAA,EAAY;MACzB;MACA,IAAIG,IAAI,GAAG,IAAI,CAACC,SAAS,EAAE;;MAE3B;MACAD,IAAI,CAACE,EAAE,CAAC,WAAW,EAAEC,eAAe,CAACC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;MAClDJ,IAAI,CAACE,EAAE,CAAC,SAAS,EAAEG,cAAc,CAAC;MAClCL,IAAI,CAACE,EAAE,CAAC,YAAY,EAAEG,cAAc,CAAC;MACrCL,IAAI,CAACE,EAAE,CAAC,WAAW,EAAEI,OAAO,CAAC;;MAE7B;MACAN,IAAI,CAACE,EAAE,CAAC,YAAY,EAAEC,eAAe,CAACC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;MACnDJ,IAAI,CAACE,EAAE,CAAC,aAAa,EAAEG,cAAc,CAAC;MACtCL,IAAI,CAACE,EAAE,CAAC,UAAU,EAAEG,cAAc,CAAC;MACnCL,IAAI,CAACE,EAAE,CAAC,WAAW,EAAEI,OAAO,CAAC;IAC/B,CAAC;IAEDC,WAAW,EAAE,SAAAA,CAAUC,MAAM,EAAE;MAC7B,IAAI,CAACC,WAAW,CAAC,UAAU,EAAED,MAAM,EAAE,IAAI,CAAC,CAAC,CAAC;MAC5C,OAAO,IAAI;IACb,CAAC;IAEDE,UAAU,EAAE,SAAAA,CAAUC,MAAM,EAAE;MAC5B,IAAIA,MAAM,GAAG,CAAC,EAAE;QACdC,MAAM,CAACvC,GAAG,CAACwC,GAAG,CAACC,KAAK,CAAC,0CAA0C,CAAC;MAClE;MACA,IAAI,CAACL,WAAW,CAAC,SAAS,EAAEE,MAAM,EAAE,IAAI,CAAC,CAAC,CAAC;MAC3C,OAAO,IAAI;IACb,CAAC;IAED;AACJ;AACA;AACA;AACA;IACIV,SAAS,EAAE,SAAAA,CAAA,EAAY;MACrB,OAAOc,EAAE,CAACC,MAAM,CAAC,GAAG,GAAG,IAAI,CAACC,KAAK,EAAE,CAAC,CAACD,MAAM,CAAC,KAAK,CAAC;IACpD,CAAC;IAED;AACJ;AACA;IACIjB,QAAQ,EAAE,SAAAA,CAAA,EAAY;MACpB;MACA,IAAI,CAACE,SAAS,EAAE,CAACC,EAAE,CAAC,WAAW,EAAE,IAAI,CAAC;MACtC,IAAI,CAACD,SAAS,EAAE,CAACC,EAAE,CAAC,WAAW,EAAE,IAAI,CAAC;MACtC,IAAI,CAACD,SAAS,EAAE,CAACC,EAAE,CAAC,SAAS,EAAE,IAAI,CAAC;MACpC,IAAI,CAACD,SAAS,EAAE,CAACC,EAAE,CAAC,YAAY,EAAE,IAAI,CAAC;MAEvC,IAAI,CAACD,SAAS,EAAE,CAACC,EAAE,CAAC,YAAY,EAAE,IAAI,CAAC;MACvC,IAAI,CAACD,SAAS,EAAE,CAACC,EAAE,CAAC,aAAa,EAAE,IAAI,CAAC;MACxC,IAAI,CAACD,SAAS,EAAE,CAACC,EAAE,CAAC,UAAU,EAAE,IAAI,CAAC;MACrC,IAAI,CAACD,SAAS,EAAE,CAACC,EAAE,CAAC,WAAW,EAAE,IAAI,CAAC;IACxC,CAAC;IAED;AACJ;AACA;IACIgB,YAAY,EAAE,SAAAA,CAAA,EAAY;MACxB,OAAOH,EAAE,CAACC,MAAM,CAAC,GAAG,GAAG,IAAI,CAACC,KAAK,EAAE,CAAC,CAACE,IAAI,EAAE;IAC7C,CAAC;IAED;AACJ;AACA;AACA;AACA;AACA;AACA;IACIC,YAAY,EAAE,SAAAA,CAAUC,IAAI,EAAE;MAC5BN,EAAE,CAACC,MAAM,CAAC,GAAG,GAAG,IAAI,CAACC,KAAK,EAAE,CAAC,CAACK,IAAI,EAAE,CAACC,SAAS,GAAGF,IAAI;MACrD,IAAI,CAACG,WAAW,CAAC,KAAK,CAAC;MACvB,OAAO,IAAI;IACb,CAAC;IAED;AACJ;AACA;AACA;AACA;IACIA,WAAW,EAAE,SAAAA,CAAUC,KAAK,EAAE;MAC5B;MACA,IAAI,CAAChB,WAAW,CAAC,UAAU,EAAEgB,KAAK,EAAE,IAAI,CAAC,CAAC,CAAC;MAC3C,IAAIA,KAAK,EAAE;QACT,IAAI,CAAC5B,aAAa,EAAE;MACtB,CAAC,MAAM;QACL,IAAI,CAACE,QAAQ,EAAE;MACjB;MACA,OAAO,IAAI;IACb,CAAC;IAED;AACJ;AACA;AACA;IACI2B,KAAK,EAAE,SAAAA,CAAA,EAAY;MACjB,IAAI,CAACC,QAAQ,EAAE;MACf,OAAO,IAAI;IACb;EACF,CAAC,CAAC;;EAEF;AACF;AACA;;EAEE;EACA,IAAIC,WAAW,GAAG,EAAE;;EAEpB;EACA,IAAIC,MAAM;;EAEV;EACA,IAAIC,cAAc,GAAG,KAAK;;EAE1B;EACA,IAAIC,WAAW,GAAGhB,EAAE,CAACiB,GAAG,CACrBC,IAAI,EAAE,CACNC,WAAW,CAAC,QAAQ,CAAC,CACrBC,OAAO,CAAC,CAAC,CAAC,CACVC,CAAC,CAAC,UAAUC,CAAC,EAAE;IACd,OAAOA,CAAC,CAACD,CAAC;EACZ,CAAC,CAAC,CACDE,CAAC,CAAC,UAAUD,CAAC,EAAE;IACd,OAAOA,CAAC,CAACC,CAAC;EACZ,CAAC,CAAC;;EAEJ;AACF;AACA;AACA;AACA;EACE,SAASnC,eAAeA,CAAA,EAAG;IACzB2B,cAAc,GAAG,IAAI;;IAErB;IACAF,WAAW,GAAG,EAAE,CAAC,CAAC;IAClB,IAAIW,IAAI,GAAGxB,EAAE,CAACC,MAAM,CAACD,EAAE,CAACyB,KAAK,CAACC,MAAM,CAAC;IACrCZ,MAAM,GAAGU,IAAI,CACVG,MAAM,CAAC,MAAM,CAAC,CACdC,IAAI,CAAC,CAACf,WAAW,CAAC,CAAC,CACnBgB,IAAI,CAAC,MAAM,EAAE,MAAM,CAAC,CACpBA,IAAI,CAAC,iBAAiB,EAAE,OAAO,CAAC,CAChCA,IAAI,CAAC,QAAQ,EAAE,IAAI,CAACC,WAAW,EAAE,CAAC,CAClCD,IAAI,CAAC,cAAc,EAAE,IAAI,CAACE,UAAU,EAAE,CAAC,CACvCF,IAAI,CAAC,GAAG,EAAEb,WAAW,CAAC;EAC3B;;EAEA;AACF;AACA;AACA;EACE,SAAS1B,cAAcA,CAAA,EAAG;IACxB;IACAyB,cAAc,GAAG,KAAK;EACxB;;EAEA;AACF;AACA;AACA;EACE,SAASxB,OAAOA,CAAA,EAAG;IACjB,IAAIwB,cAAc,EAAE;MAClB,IAAIiB,aAAa,GAAGhC,EAAE,CAACiC,KAAK,CAAC,IAAI,CAAC;MAClCpB,WAAW,CAACqB,IAAI,CAAC;QAAEb,CAAC,EAAEW,aAAa,CAAC,CAAC,CAAC;QAAET,CAAC,EAAES,aAAa,CAAC,CAAC;MAAE,CAAC,CAAC;MAE9DlB,MAAM,CAACe,IAAI,CAAC,GAAG,EAAE,UAAUP,CAAC,EAAE;QAC5B,OAAON,WAAW,CAACM,CAAC,CAAC;MACvB,CAAC,CAAC;IACJ;EACF;EAEA,OAAO3D,UAAU;AACnB,CAAC,CAAC"}